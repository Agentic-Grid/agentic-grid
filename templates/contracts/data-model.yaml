# Data Model Contract Template
# This file defines ALL data entities, their fields, types, and relationships.
# RULE: Agents MUST read this before implementing any database or API code.
# Generated by: PLANNER agent during architecture phase

version: "1.0"
project: "{project_name}"
created_at: "{timestamp}"
updated_at: "{timestamp}"

# =============================================================================
# ENTITY DEFINITIONS
# =============================================================================
# Each entity represents a database table/collection with complete specifications.
# DO NOT leave any field as "TBD" or "to be determined" - specify everything.

entities:
  # ---------------------------------------------------------------------------
  # EXAMPLE: User Entity (delete and replace with your entities)
  # ---------------------------------------------------------------------------
  User:
    description: "Application user account"
    table_name: users

    # Primary key configuration
    primary_key:
      field: id
      type: uuid
      generated: true

    # All fields with COMPLETE type information
    fields:
      id:
        type: uuid
        nullable: false
        description: "Unique identifier"

      email:
        type: string
        max_length: 255
        nullable: false
        unique: true
        validation: email
        description: "User's email address for login"

      password_hash:
        type: string
        max_length: 255
        nullable: false
        description: "Bcrypt hashed password (cost factor 12)"

      name:
        type: string
        max_length: 100
        nullable: false
        description: "Display name"

      role:
        type: enum
        values: ["user", "admin", "moderator"]
        default: "user"
        nullable: false
        description: "User permission level"

      avatar_url:
        type: string
        max_length: 500
        nullable: true
        description: "Profile picture URL"

      email_verified:
        type: boolean
        default: false
        nullable: false
        description: "Whether email has been verified"

      created_at:
        type: timestamp
        nullable: false
        default: "now()"
        description: "Account creation timestamp"

      updated_at:
        type: timestamp
        nullable: false
        default: "now()"
        on_update: "now()"
        description: "Last update timestamp"

      deleted_at:
        type: timestamp
        nullable: true
        description: "Soft delete timestamp"

    # Indexes for query performance
    indexes:
      - name: idx_users_email
        fields: [email]
        unique: true
      - name: idx_users_role
        fields: [role]
      - name: idx_users_created
        fields: [created_at]

    # Relationships to other entities
    relationships:
      # Example: User has many Posts
      posts:
        type: has_many
        target: Post
        foreign_key: author_id
        on_delete: cascade

      # Example: User has one Profile
      profile:
        type: has_one
        target: Profile
        foreign_key: user_id
        on_delete: cascade

  # ---------------------------------------------------------------------------
  # ADD YOUR ENTITIES BELOW
  # ---------------------------------------------------------------------------
  # Copy the User template above and modify for each entity in your system.
  # Remember: Be SPECIFIC. Every field needs complete type info.
  # ---------------------------------------------------------------------------

# =============================================================================
# ENUMS
# =============================================================================
# Define all enum types used across entities

enums:
  UserRole:
    values:
      - user
      - admin
      - moderator
    description: "User permission levels"

  # Add more enums as needed
  # Status:
  #   values: [draft, pending, approved, rejected]
  #   description: "Content approval status"

# =============================================================================
# TYPESCRIPT TYPES
# =============================================================================
# Generated TypeScript types for frontend/backend consumption
# PLANNER generates these; DATA agent uses them

typescript:
  # Type generation target paths
  output_paths:
    api: "api/src/types/entities.ts"
    app: "app/src/types/entities.ts"

  # Example generated types (PLANNER fills these in)
  types: |
    // Auto-generated from data-model.yaml - DO NOT EDIT MANUALLY

    export type UserRole = 'user' | 'admin' | 'moderator';

    export interface User {
      id: string;
      email: string;
      name: string;
      role: UserRole;
      avatarUrl: string | null;
      emailVerified: boolean;
      createdAt: Date;
      updatedAt: Date;
      deletedAt: Date | null;
    }

    export interface CreateUserInput {
      email: string;
      password: string;
      name: string;
      role?: UserRole;
    }

    export interface UpdateUserInput {
      name?: string;
      avatarUrl?: string | null;
      role?: UserRole;
    }

# =============================================================================
# VALIDATION RULES
# =============================================================================
# Shared validation rules referenced by entities

validation_rules:
  email:
    pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
    message: "Invalid email format"

  password:
    min_length: 8
    max_length: 128
    pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).+$"
    message: "Password must contain uppercase, lowercase, and number"

  slug:
    pattern: "^[a-z0-9]+(?:-[a-z0-9]+)*$"
    message: "Invalid slug format (lowercase letters, numbers, hyphens only)"

# =============================================================================
# MIGRATION HINTS
# =============================================================================
# Guidance for DATA agent when creating migrations

migration_hints:
  naming_convention: "snake_case for all database objects"
  uuid_generation: "Use gen_random_uuid() for PostgreSQL"
  timestamps: "Always include created_at and updated_at"
  soft_delete: "Use deleted_at column, not hard deletes"
  foreign_keys: "Always create with ON DELETE specification"

# =============================================================================
# USAGE NOTES (DELETE WHEN USING)
# =============================================================================
#
# This contract is the SINGLE SOURCE OF TRUTH for all data structures.
#
# WORKFLOW:
# 1. PLANNER creates this file during architecture phase
# 2. DATA agent reads this and creates migrations
# 3. BACKEND agent reads this and implements repository patterns
# 4. FRONTEND agent reads the TypeScript types
#
# RULES:
# - Every field MUST have: type, nullable, description
# - Every relationship MUST specify: type, target, foreign_key, on_delete
# - Enums MUST be defined in the enums section
# - TypeScript types MUST be generated (not written manually in code)
#
# =============================================================================
