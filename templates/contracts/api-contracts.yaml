# API Contracts Template
# This file defines ALL API endpoints with complete request/response specifications.
# RULE: Agents MUST read this before implementing any API or client code.
# Generated by: PLANNER agent during architecture phase

version: "1.0"
project: "{project_name}"
base_url: "/api/v1"
created_at: "{timestamp}"
updated_at: "{timestamp}"

# =============================================================================
# GLOBAL CONFIGURATION
# =============================================================================

config:
  authentication:
    type: "bearer"
    header: "Authorization"
    format: "Bearer {token}"

  rate_limiting:
    default: "100 requests per minute"
    auth_endpoints: "10 requests per minute"

  response_format:
    success:
      data: "Response payload"
      meta: "Pagination, timestamps, etc."
    error:
      error:
        code: "ERROR_CODE"
        message: "Human readable message"
        details: "Additional context (optional)"

# =============================================================================
# ENDPOINT DEFINITIONS
# =============================================================================
# Organize by resource/feature. Be EXHAUSTIVE - every endpoint must be here.

endpoints:
  # ---------------------------------------------------------------------------
  # AUTHENTICATION
  # ---------------------------------------------------------------------------
  auth:
    # POST /api/v1/auth/register
    register:
      method: POST
      path: /auth/register
      description: "Create new user account"
      auth_required: false
      rate_limit: "5 requests per minute"

      request:
        body:
          email:
            type: string
            required: true
            validation: email
            example: "user@example.com"
          password:
            type: string
            required: true
            min_length: 8
            max_length: 128
            validation: password
            example: "SecurePass123"
          name:
            type: string
            required: true
            min_length: 2
            max_length: 100
            example: "John Doe"

      responses:
        201:
          description: "Account created successfully"
          body:
            data:
              user:
                id:
                  {
                    type: string,
                    example: "550e8400-e29b-41d4-a716-446655440000",
                  }
                email: { type: string, example: "user@example.com" }
                name: { type: string, example: "John Doe" }
                role: { type: string, example: "user" }
              token:
                type: string
                example: "eyJhbGciOiJIUzI1NiIs..."

        400:
          description: "Validation error"
          body:
            error:
              code: "VALIDATION_ERROR"
              message: "Invalid request data"
              details:
                field: "email"
                issue: "Invalid email format"

        409:
          description: "Email already exists"
          body:
            error:
              code: "EMAIL_EXISTS"
              message: "An account with this email already exists"

    # POST /api/v1/auth/login
    login:
      method: POST
      path: /auth/login
      description: "Authenticate user and get token"
      auth_required: false
      rate_limit: "10 requests per minute per IP"

      request:
        body:
          email:
            type: string
            required: true
            validation: email
            example: "user@example.com"
          password:
            type: string
            required: true
            example: "SecurePass123"

      responses:
        200:
          description: "Login successful"
          body:
            data:
              user:
                id: { type: string }
                email: { type: string }
                name: { type: string }
                role: { type: string }
              token:
                type: string
                description: "JWT token valid for 7 days"
              expiresAt:
                type: string
                format: iso8601
                example: "2026-01-28T00:00:00Z"

        401:
          description: "Invalid credentials"
          body:
            error:
              code: "INVALID_CREDENTIALS"
              message: "Invalid email or password"

        429:
          description: "Too many attempts"
          body:
            error:
              code: "RATE_LIMITED"
              message: "Too many login attempts. Please try again later."

    # POST /api/v1/auth/logout
    logout:
      method: POST
      path: /auth/logout
      description: "Invalidate current token"
      auth_required: true

      request:
        headers:
          Authorization: "Bearer {token}"

      responses:
        200:
          description: "Logged out successfully"
          body:
            data:
              message: "Logged out successfully"

    # GET /api/v1/auth/me
    me:
      method: GET
      path: /auth/me
      description: "Get current user info"
      auth_required: true

      responses:
        200:
          description: "Current user data"
          body:
            data:
              user:
                id: { type: string }
                email: { type: string }
                name: { type: string }
                role: { type: string }
                avatarUrl: { type: string, nullable: true }
                emailVerified: { type: boolean }
                createdAt: { type: string, format: iso8601 }

        401:
          description: "Not authenticated"
          body:
            error:
              code: "UNAUTHORIZED"
              message: "Authentication required"

  # ---------------------------------------------------------------------------
  # USERS (Admin operations)
  # ---------------------------------------------------------------------------
  users:
    # GET /api/v1/users
    list:
      method: GET
      path: /users
      description: "List all users (admin only)"
      auth_required: true
      required_role: admin

      request:
        query:
          page:
            type: integer
            default: 1
            min: 1
          limit:
            type: integer
            default: 20
            min: 1
            max: 100
          role:
            type: string
            enum: [user, admin, moderator]
            description: "Filter by role"
          search:
            type: string
            description: "Search by name or email"

      responses:
        200:
          description: "User list with pagination"
          body:
            data:
              users:
                type: array
                items:
                  id: { type: string }
                  email: { type: string }
                  name: { type: string }
                  role: { type: string }
                  createdAt: { type: string }
            meta:
              page: { type: integer }
              limit: { type: integer }
              total: { type: integer }
              totalPages: { type: integer }

    # GET /api/v1/users/:id
    get:
      method: GET
      path: /users/:id
      description: "Get user by ID"
      auth_required: true

      request:
        params:
          id:
            type: string
            format: uuid
            required: true

      responses:
        200:
          description: "User data"
          body:
            data:
              user:
                id: { type: string }
                email: { type: string }
                name: { type: string }
                role: { type: string }
                avatarUrl: { type: string, nullable: true }
                createdAt: { type: string }

        404:
          description: "User not found"
          body:
            error:
              code: "NOT_FOUND"
              message: "User not found"

    # PATCH /api/v1/users/:id
    update:
      method: PATCH
      path: /users/:id
      description: "Update user (self or admin)"
      auth_required: true

      request:
        params:
          id:
            type: string
            format: uuid
            required: true
        body:
          name:
            type: string
            min_length: 2
            max_length: 100
          avatarUrl:
            type: string
            nullable: true
          role:
            type: string
            enum: [user, admin, moderator]
            description: "Admin only"

      responses:
        200:
          description: "Updated user"
          body:
            data:
              user:
                id: { type: string }
                email: { type: string }
                name: { type: string }
                role: { type: string }
                avatarUrl: { type: string, nullable: true }
                updatedAt: { type: string }

        403:
          description: "Not authorized"
          body:
            error:
              code: "FORBIDDEN"
              message: "You can only update your own profile"

    # DELETE /api/v1/users/:id
    delete:
      method: DELETE
      path: /users/:id
      description: "Delete user (soft delete, admin only)"
      auth_required: true
      required_role: admin

      request:
        params:
          id:
            type: string
            format: uuid
            required: true

      responses:
        200:
          description: "User deleted"
          body:
            data:
              message: "User deleted successfully"

        404:
          description: "User not found"
          body:
            error:
              code: "NOT_FOUND"
              message: "User not found"

  # ---------------------------------------------------------------------------
  # ADD YOUR ENDPOINTS BELOW
  # ---------------------------------------------------------------------------
  # Copy the patterns above for each resource in your API.
  # Remember: Be SPECIFIC. Every field needs type, required, validation.
  # ---------------------------------------------------------------------------

# =============================================================================
# ERROR CODES
# =============================================================================
# Standard error codes used across the API

error_codes:
  VALIDATION_ERROR:
    http_status: 400
    description: "Request validation failed"

  UNAUTHORIZED:
    http_status: 401
    description: "Authentication required"

  INVALID_CREDENTIALS:
    http_status: 401
    description: "Invalid email or password"

  FORBIDDEN:
    http_status: 403
    description: "Not authorized to perform this action"

  NOT_FOUND:
    http_status: 404
    description: "Resource not found"

  EMAIL_EXISTS:
    http_status: 409
    description: "Email already registered"

  RATE_LIMITED:
    http_status: 429
    description: "Too many requests"

  INTERNAL_ERROR:
    http_status: 500
    description: "Internal server error"

# =============================================================================
# TYPESCRIPT TYPES
# =============================================================================
# Generated TypeScript types for API requests/responses

typescript:
  output_paths:
    api: "api/src/types/api.ts"
    app: "app/src/types/api.ts"

  types: |
    // Auto-generated from api-contracts.yaml - DO NOT EDIT MANUALLY

    // Request types
    export interface RegisterRequest {
      email: string;
      password: string;
      name: string;
    }

    export interface LoginRequest {
      email: string;
      password: string;
    }

    export interface UpdateUserRequest {
      name?: string;
      avatarUrl?: string | null;
      role?: 'user' | 'admin' | 'moderator';
    }

    export interface PaginationParams {
      page?: number;
      limit?: number;
    }

    // Response types
    export interface AuthResponse {
      user: User;
      token: string;
      expiresAt: string;
    }

    export interface UserListResponse {
      users: User[];
      meta: {
        page: number;
        limit: number;
        total: number;
        totalPages: number;
      };
    }

    export interface ApiError {
      code: string;
      message: string;
      details?: Record<string, unknown>;
    }

# =============================================================================
# USAGE NOTES (DELETE WHEN USING)
# =============================================================================
#
# This contract is the SINGLE SOURCE OF TRUTH for all API behavior.
#
# WORKFLOW:
# 1. PLANNER creates this file during architecture phase
# 2. BACKEND agent implements endpoints exactly as specified
# 3. FRONTEND agent builds API client based on these contracts
# 4. QA agent validates responses match specifications
#
# RULES:
# - Every endpoint MUST have: method, path, description, auth_required
# - Every request param MUST have: type, required
# - Every response MUST have: status code, description, body structure
# - Use examples liberally - they clarify intent
#
# =============================================================================
