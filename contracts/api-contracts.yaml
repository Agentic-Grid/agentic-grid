# API Contracts
# Owner: BACKEND | Consumers: FRONTEND
# Last Updated: [DATE]

version: "1.0"
basePath: /api/v1

# =============================================================================
# AUTHENTICATION
# =============================================================================

auth:
  endpoints:
    login:
      method: POST
      path: /auth/login
      description: Authenticate user and return tokens
      request:
        body:
          email:
            type: string
            format: email
            required: true
          password:
            type: string
            minLength: 8
            required: true
      response:
        success:
          status: 200
          body:
            user:
              type: User
            accessToken:
              type: string
            refreshToken:
              type: string
        errors:
          - status: 401
            code: INVALID_CREDENTIALS
            message: Invalid email or password
          - status: 429
            code: RATE_LIMITED
            message: Too many login attempts

    logout:
      method: POST
      path: /auth/logout
      description: Invalidate refresh token
      auth: required
      response:
        success:
          status: 204

    refresh:
      method: POST
      path: /auth/refresh
      description: Get new access token using refresh token
      request:
        body:
          refreshToken:
            type: string
            required: true
      response:
        success:
          status: 200
          body:
            accessToken:
              type: string

# =============================================================================
# USERS
# =============================================================================

users:
  endpoints:
    list:
      method: GET
      path: /users
      description: Get paginated list of users
      auth: required
      roles: [admin]
      query:
        page:
          type: integer
          default: 1
        limit:
          type: integer
          default: 20
          max: 100
        sort:
          type: string
          default: createdAt:desc
      response:
        success:
          status: 200
          body:
            data:
              type: array
              items: User
            meta:
              type: PaginationMeta

    get:
      method: GET
      path: /users/:id
      description: Get user by ID
      auth: required
      response:
        success:
          status: 200
          body:
            data:
              type: User
        errors:
          - status: 404
            code: NOT_FOUND
            message: User not found

    create:
      method: POST
      path: /users
      description: Create new user
      request:
        body:
          email:
            type: string
            format: email
            required: true
          name:
            type: string
            minLength: 1
            maxLength: 100
            required: true
          password:
            type: string
            minLength: 8
            required: true
          role:
            type: string
            enum: [user, admin]
            default: user
      response:
        success:
          status: 201
          body:
            data:
              type: User
        errors:
          - status: 400
            code: VALIDATION_ERROR
            message: Validation failed
          - status: 409
            code: EMAIL_EXISTS
            message: Email already in use

    update:
      method: PATCH
      path: /users/:id
      description: Update user
      auth: required
      request:
        body:
          name:
            type: string
            minLength: 1
            maxLength: 100
          email:
            type: string
            format: email
      response:
        success:
          status: 200
          body:
            data:
              type: User

    delete:
      method: DELETE
      path: /users/:id
      description: Delete user (soft delete)
      auth: required
      roles: [admin]
      response:
        success:
          status: 204

# =============================================================================
# TYPES
# =============================================================================

types:
  User:
    id:
      type: string
      format: uuid
    email:
      type: string
      format: email
    name:
      type: string
    role:
      type: string
      enum: [user, admin]
    createdAt:
      type: string
      format: date-time
    updatedAt:
      type: string
      format: date-time

  PaginationMeta:
    total:
      type: integer
    page:
      type: integer
    limit:
      type: integer
    totalPages:
      type: integer

  ErrorResponse:
    error:
      type: string
      description: Human-readable error message
    code:
      type: string
      description: Machine-readable error code
    details:
      type: object
      description: Additional error context

# =============================================================================
# ERROR CODES
# =============================================================================

errorCodes:
  # 400 Bad Request
  VALIDATION_ERROR:
    status: 400
    message: Input validation failed
  INVALID_REQUEST:
    status: 400
    message: Malformed request

  # 401 Unauthorized
  UNAUTHORIZED:
    status: 401
    message: Authentication required
  INVALID_CREDENTIALS:
    status: 401
    message: Invalid credentials
  INVALID_TOKEN:
    status: 401
    message: Invalid or expired token

  # 403 Forbidden
  FORBIDDEN:
    status: 403
    message: Insufficient permissions

  # 404 Not Found
  NOT_FOUND:
    status: 404
    message: Resource not found

  # 409 Conflict
  CONFLICT:
    status: 409
    message: Resource conflict
  EMAIL_EXISTS:
    status: 409
    message: Email already in use

  # 429 Rate Limited
  RATE_LIMITED:
    status: 429
    message: Too many requests

  # 500 Internal Error
  INTERNAL_ERROR:
    status: 500
    message: Internal server error
